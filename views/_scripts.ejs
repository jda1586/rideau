<script src="/javascripts/foundation/foundation.js"></script>
<script src="/javascripts/foundation/foundation.reveal.js"></script>
<script src="/javascripts/foundation/foundation.accordion.js"></script>
<script src="/javascripts/foundation/foundation.tooltip.js"></script>

<!-- Vendor scripts -->
<script src="/javascripts/jquery.mixitup.js"></script>

<!-- Sly horizontal slider -->
<script src="/javascripts/sly/plugins.js"></script>
<script src="/javascripts/sly/sly.js"></script>

<!-- Own scripts -->
<script src="/javascripts/rideau.js"></script>

<script>
    //Hide prices in eboutique (TODO: Relocate pls)
	$(".outer").hover(function() {
		$(this).find(".inner").css("visibility", "visible");
	});

	$(".outer").mouseleave(function() {
		$(this).find(".inner").css("visibility","hidden");
	});
    
    $(document).ready(function() {
        
        
        // Find all YouTube videos
        var $allVideos = $(".fluid-vid"),

            // The element that is fluid width
            $fluidEl = $(".fluid");

        // Figure out and save aspect ratio for each video
        $allVideos.each(function() {

          $(this)
            .data('aspectRatio', this.height / this.width)

            // and remove the hard coded width/height
            .removeAttr('height')
            .removeAttr('width');

        });

        // When the window is resized
        $(window).resize(function() {
            console.log("rsz");

          var newWidth = $fluidEl.width();

          // Resize all videos according to their own aspect ratio
          $allVideos.each(function() {

            var $el = $(this);
            $el
              .width(newWidth)
              .height(newWidth * $el.data('aspectRatio'));
              
                        console.log(newWidth);
          console.log(newWidth * $el.data('aspectRatio'));

          });
          


        // Kick off one resize to fix all videos on page load
        }).resize();
        
        
        
        $(document)
            .on('open.fndtn.reveal', '[data-reveal]', function(){
                $('body').addClass('modal-open');
            })
            .on('close.fndtn.reveal', '[data-reveal]', function(){
                $('body').removeClass('modal-open');
            });

        //Female / male switcher (TODO: Relocate pls)
        $('.male_button').on('click', function () {
            $('.male_container').removeClass('hidden');
            $('.female_container').addClass('hidden');
            window.location.hash = "male";
        });
        /* Disabled by Rideau's request */
        /*$('.female_button').on('click', function () {
            $('.male_container').addClass('hidden');
            $('.female_container').removeClass('hidden');
            window.location.hash = "female";
        });*/
        var show_male = (window.location.hash == "#male" ? 1 : 0);
        if (window.location.hash == "#male") {
            $('.male_button').trigger("click");
        } else if (window.location.hash == "#female") {
            $('.female_button').trigger("click");
        }

	    //Delete background when clicking to footer bottom text (TODO: Relocate pls)
		$('a[data-reveal-id]').on('click', function() {
			var modalDiv = $(this).attr('data-reveal-id');

			var cartdata = (localStorage && localStorage.getItem('storedCart')) ? localStorage.getItem('storedCart'): "";

			var arrayModals = ['subscription-modal', 'empty-carr-modal', 'login-modal', 'post-subscription-modal', 'addedtocart-modal'];

		    if ( jQuery.inArray(modalDiv, arrayModals) !== -1 ) {
		        $('.reveal-modal-bg').css('background-color','transparent');
		        $('.reveal-modal').css('background','rgba(0, 0, 0, 0.75)');
		    } else {
		    	$('.reveal-modal-bg').css('background-color','rgba(0, 0, 0, 0.75)');
		    	$('.reveal-modal').css('background','transparent');
		    }

		    if (modalDiv == 'carr-modal') {

				$.post('/simple-cart', { cdata: cartdata, modal: "stored-products" }, function(data) {
					if(data) {
						$('.stored-products').html(data);
						$('#carr-modal').foundation('reveal', 'open');
					}
				});
		    }
		});

	    // Hide background in eboutique
	    $('a.close').click(function() {
	    	$('#carr-modal').foundation('reveal', 'close');
	    });

	    $("input[data-reveal-id='post-subscription-modal']").click(function() {
	    	var subemail = $("input[name='subscription-email']").val();
			$.post('/subscriptions', { email: subemail }, function(data) {
				if(data) {
					console.log(data);
				}
			});
	    });

	    var loggedinHash = window.location.hash;
	    if (loggedinHash == 'loggedin') {
	    	$('#loggedin-modal').foundation('reveal', 'open');
	    }

		$('input#checkboxterms').change(function () {
		    if ($('input#checkboxterms').is(":checked") == true) {
		        $('#got-to-stripe').removeAttr('disabled');
		    }
		    $('#got-to-stripe').prop('disabled', true);
		});
    });

    // Store product to local storage
	var storedItem = {};
	$("#add-cart").click(function() {

		var el      = $(this).parent();
		var id_item = $("input[name='id_item']").val();
		var ref_v   = $('span.ref').attr('data-storage');
		var size_v  = $("input[id^='size-']:checked").attr('value');
		var qty_v   = 1;
		var price_v = $('span.price').attr('data-storage');

		var key = ref_v + size_v; // Key of object item is REFERENCE + SIZE

		if (localStorage.getItem("storedCart") === null) {
			storedItem[key] = {
				id_item: id_item,
				ref    : ref_v,
				size   : size_v,
				qty    : qty_v,
				price  : price_v,
			};
			localStorage.setItem("storedCart", JSON.stringify(storedItem));
		} else {
			var parseddata = JSON.parse(localStorage.getItem("storedCart"));
			parseddata[key] = {
				id_item: id_item,
				ref    : ref_v,
				size   : size_v,
				qty    : qty_v,
				price  : price_v,
			};
			localStorage.setItem("storedCart", JSON.stringify(parseddata));
		}
		$("#addedtocart-modal").foundation('reveal', 'open');
	});
</script>

<!-- Init foundation, must be last on this script -->
<script>
	$(document).foundation();
</script>